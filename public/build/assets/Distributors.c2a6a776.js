import{u as T,r as c,$ as U,o as L,E as M,a as n,c as F,w as k,b as t,d as w,e as r,t as d,f as u,v as b,g as l,h as m,V as S,p as q,F as I,i as z,k as D}from"./app.4f842eb5.js";import{A as P}from"./vue3-apexcharts.common.293a5129.js";import{e as V,D as O}from"./dataTables.bootstrap5.49e077a0.js";import"./dataTables.responsive.5af08bea.js";import{_ as j}from"./ModalComponent.28977ba9.js";import{_ as G}from"./GenericLayout.e60c52a9.js";import"./app.min.779aadf7.js";import"./index.bacd0695.js";import"./_plugin-vue_export-helper.cdc0426e.js";const R={class:"row g-4 mb-4"},K={class:"col-md-8"},X={class:"card"},H={class:"card-body",style:{position:"relative"}},J=t("h6",{class:"card-title"},"New Distributors",-1),Q={style:{"max-height":"295px"}},W=t("div",{class:"resize-triggers"},[t("div",{class:"expand-trigger"},[t("div",{style:{width:"996px",height:"275px"}})]),t("div",{class:"contract-trigger"})],-1),Y={class:"col-md-4"},Z={class:"card"},tt={class:"card-body"},et=t("div",{class:"mb-4"},[t("h6",{class:"card-title mb-0"},"No.Of Distributors")],-1),st={class:"text-center"},rt=t("div",{class:"display-6"},[t("span",null,[t("i",{class:"bi bi-truck h1","data-v-ca37e4bd":""})])],-1),ot=t("div",{class:"text-muted d-flex align-items-center justify-content-center"},[t("span",{class:"text-success me-3 d-block"},[t("i",{class:"bi bi-arrow-up me-1 small"}),D("+35 ")]),D(" Point from last month ")],-1),it={class:"card"},at=t("div",{class:"card-header"},[t("h5",null,"Distributors"),t("button",{type:"button",id:"modalBtn","data-bs-toggle":"modal","data-bs-target":"#exampleModal",class:"btn btn-icon btn-primary"},[t("i",{class:"bi bi-plus-circle"}),D(" Add Distributor ")])],-1),nt={class:"card-body"},dt=t("thead",null,[t("tr",null,[t("th",null,"Ref No."),t("th",null,"First Name"),t("th",null,"Last Name"),t("th",null,"Email"),t("th",null,"Gender"),t("th",null,"Country"),t("th",null,"Binapoints"),t("th",null,"Balance"),t("th",null,"Parent"),t("th",null,"Verified"),t("th",null,"Suspended"),t("th",null,"Created At"),t("th",null,"Actions")])],-1),lt=["onSubmit"],ct={class:"row"},ut={class:"col"},mt={class:"form-group"},_t=t("label",null,"First Name",-1),bt={key:0,class:"invalid-feedback"},ft={class:"col"},pt={class:"form-group"},ht=t("label",null,"Last Name",-1),vt={key:0,class:"invalid-feedback"},gt={class:"row mt-3"},yt={class:"col"},xt={class:"form-group"},kt=t("label",null,"Email",-1),wt={key:0,class:"invalid-feedback"},Dt={class:"row mt-3"},Nt={class:"col"},Et={class:"form-group"},At=t("label",{for:"gender"},"Gender",-1),St=t("option",{value:""},"Select Gender",-1),Vt=t("option",{value:"0"},"Male",-1),Bt=t("option",{value:"1"},"Female",-1),$t=[St,Vt,Bt],Ct={key:0,class:"invalid-feedback"},Tt={class:"col"},Ut={class:"form-group"},Lt=t("label",{for:"country"},"Country",-1),Mt=t("option",{value:""},"Select Country",-1),Ft=["value"],qt={key:0,class:"invalid-feedback"},It={class:"row mt-3"},zt={class:"col"},Pt=t("label",{for:"domain"},"Prefered Domain Name",-1),Ot={class:"input-group mb-3"},jt=t("span",{class:"input-group-text",id:"basic-addon2"},".binasta.co.ke",-1),Gt={key:0,class:"invalid-feedback"},Rt={class:"row mt-3"},Kt={class:"col"},Xt=t("label",{for:"parent_id"},"Parent Ref No.",-1),Ht={key:0,class:"invalid-feedback"},Jt=t("div",{class:"row mt-4"},[t("div",{class:"col"},[t("div",{class:"form-group"},[t("button",{type:"button",class:"btn btn-danger",style:{"margin-right":"10px"},"data-bs-dismiss":"modal"}," Close "),t("button",{id:"submitBtn",type:"submit",class:"btn btn-primary"}," Save ")])])],-1),ie={__name:"Distributors",props:{distributors:Array,countries:Array},setup(h){const v=h;V.use(O);const e=T({first_name:"",last_name:"",email:"",country_id:"",gender:"",domain:"",distributor_id:""}),g=c(""),y=c(null),f=c(null),p=c([{name:"Distributors",data:[]}]),x=c([]);let _=c({chart:{type:"line",offsetX:-15,foreColor:"#b8b8b8",zoom:{enabled:!1},toolbar:{show:!1}},dataLabels:{enabled:!1},theme:{mode:U("body").hasClass("dark")?"dark":"light"},colors:["#ff6e40"],stroke:{width:4,curve:"smooth"},legend:{show:!1},markers:{size:0,hover:{sizeOffset:6}},yaxis:{min:0,tickAmount:1},xaxis:{min:x.value[x.value.length-1],categories:x.value},tooltip:{y:[{title:{formatter:function(i){return i}}},{title:{formatter:function(i){return i}}},{title:{formatter:function(i){return i}}}]},grid:{borderColor:"#ededed"}}),N;const B=()=>{clearTimeout(N),N=setTimeout(()=>{fetch("/distributors/ref/"+g.value).then(i=>i.json()).then(i=>y.value=i.id).catch(i=>console.log("fetchDistributorId",i))},2e3)},$=()=>{let i="0123456789abcdefghijklmnopqrstuvwxyz!@#$%^&*()ABCDEFGHIJKLMNOPQRSTUVWXYZ",o=12,s="";for(let a=0;a<=o;a++){let A=Math.floor(Math.random()*i.length);s+=i.substring(A,A+1)}return s},C=()=>{if(e.clearErrors(),(!e.first_name||e.first_name.trim()=="")&&e.setError("first_name","first name field is required"),(!e.last_name||e.last_name.trim()=="")&&e.setError("last_name","last name field is required"),(!e.email||e.email.trim()=="")&&e.setError("email","email field is required"),(!e.country_id||parseInt(e.country_id)===NaN)&&e.setError("country_id","country field is required"),(!e.gender||parseInt(e.gender)===NaN)&&e.setError("gender","gender field is required"),(!e.domain||e.domain.trim()=="")&&e.setError("domain","domain field is required"),e.errors&&Object.keys(e.errors).length)return;const i=document.getElementById("submitBtn");i.innerText="Saving...",e.transform(o=>({...o,password:$(),parent_distributor_id:y.value})).post("/distributors",{onSuccess(){e.reset(),y.value=""},onFinish(){i.innerText="Save"}})},E=c(0);return L(()=>{document.getElementById("dt").addEventListener("click",function(i){if(i.target.nodeName!=="BUTTON")return;const o=i.target.getAttribute("data-id"),s=i.target.getAttribute("data-type");s==="del"?confirm("Are you sure you want to delete this distributor?")&&e.delete(`/distributors/${o}`):s==="suspend"?confirm("Are you sure you want to suspend this distributor?")&&(f.value=v.distributors.filter(({id:a})=>a==o)[0],e.distributor_id=f.value.id,e.post("/distributors/suspend")):s==="verify"&&confirm("Are you sure you want to verify this distributor?")&&(f.value=v.distributors.filter(({id:a})=>a==o)[0],e.distributor_id=f.value.id,e.post("/distributors/verify"))}),v.distributors.forEach(i=>{if(p.value[0].data.length<10){const o=new Date(i.created_at);_.value.xaxis.categories.includes(`${o.getDay()} ${o.toLocaleDateString("en-us",{month:"short"})}`)||_.value.xaxis.categories.push(`${o.getDay()} ${o.toLocaleDateString("en-us",{month:"short"})}`),p.value[0].data.push(i.total)}E.value++}),p.value[0].data.reverse(),_.value.xaxis.categories.reverse(),_.value.xaxis.min=_.value.xaxis.categories[0],M(()=>{window.dispatchEvent(new Event("resize"))})}),(i,o)=>(n(),F(G,null,{default:k(()=>[t("div",R,[t("div",K,[t("div",X,[t("div",H,[J,t("div",Q,[w(r(P),{options:r(_),series:p.value,height:"200",width:"103%"},null,8,["options","series"])]),W])])]),t("div",Y,[t("div",Z,[t("div",tt,[et,t("div",st,[rt,t("h4",null,d(E.value),1)]),ot])])])]),t("div",it,[at,t("div",nt,[w(r(V),{id:"dt",options:{responsive:!0},class:"display table table-responsive",data:h.distributors,columns:[{data:"ref"},{data:"first_name"},{data:"last_name"},{data:"email"},{data:"gender",render:s=>s?"Female":"Male"},{data:"country",render:s=>s.name},{data:"binapoints"},{data:"balance"},{data:"patron",render:s=>s?`${s.first_name} ${s.last_name}`:"<span class='badge bg-primary'>Binasta Ltd.</span>"},{data:"verified",render:s=>s?"<span class='badge bg-success'>Verified</span>":"<span class='badge bg-danger'>Unverified</span>"},{data:"suspended",render:s=>s?"<span class='badge bg-danger'>Suspended</span>":"<span class='badge bg-success'>Active</span>"},{data:"created_at",render:s=>new Date(s).toDateString()},{data:null,render:s=>{let a="";return s.suspended?a+=`<button data-id='${s.id}' data-type='suspend' class='btn btn-sm btn-secondary mr-3'>Block</button>`:`${s.id}`,s.verified||(a+=`<button data-id='${s.id}' data-type='verify' class='btn btn-sm btn-success mr-3'>Verify</button> `),a+=`<button data-id='${s.id}' data-type='del' class='btn btn-sm btn-danger'>Delete</button>`,a}}]},{default:k(()=>[dt]),_:1},8,["data","columns"])])]),w(j,{title:"Add Distributor"},{default:k(()=>[t("form",{onSubmit:z(C,["prevent"])},[t("div",ct,[t("div",ut,[t("div",mt,[_t,u(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>r(e).first_name=s),class:"form-control"},null,512),[[b,r(e).first_name]]),r(e).errors.first_name?(n(),l("div",bt,d(r(e).errors.first_name),1)):m("",!0)])]),t("div",ft,[t("div",pt,[ht,u(t("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=s=>r(e).last_name=s),class:"form-control"},null,512),[[b,r(e).last_name]]),r(e).errors.last_name?(n(),l("div",vt,d(r(e).errors.last_name),1)):m("",!0)])])]),t("div",gt,[t("div",yt,[t("div",xt,[kt,u(t("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=s=>r(e).email=s),class:"form-control"},null,512),[[b,r(e).email]]),r(e).errors.email?(n(),l("div",wt,d(r(e).errors.email),1)):m("",!0)])])]),t("div",Dt,[t("div",Nt,[t("div",Et,[At,u(t("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>r(e).gender=s),class:"form-control"},$t,512),[[S,r(e).gender]]),r(e).errors.gender?(n(),l("div",Ct,d(r(e).errors.gender),1)):m("",!0)])]),t("div",Tt,[t("div",Ut,[Lt,u(t("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>r(e).country_id=s),class:"form-control"},[Mt,(n(!0),l(I,null,q(h.countries,s=>(n(),l("option",{key:s.id,value:s.id},d(s.name),9,Ft))),128))],512),[[S,r(e).country_id]]),r(e).errors.country_id?(n(),l("div",qt,d(r(e).errors.country_id),1)):m("",!0)])])]),t("div",It,[t("div",zt,[Pt,t("div",Ot,[u(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=s=>r(e).domain=s)},null,512),[[b,r(e).domain]]),jt]),r(e).errors.domain?(n(),l("div",Gt,d(r(e).errors.domain),1)):m("",!0)])]),t("div",Rt,[t("div",Kt,[Xt,u(t("input",{type:"text",onKeyup:B,"onUpdate:modelValue":o[6]||(o[6]=s=>g.value=s),class:"form-control"},null,544),[[b,g.value]]),r(e).errors.parent_distributor_id?(n(),l("div",Ht,d(r(e).errors.parent_distributor_id),1)):m("",!0)])]),Jt],40,lt)]),_:1})]),_:1}))}};export{ie as default};
