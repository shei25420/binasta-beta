import{u as y,r as k,o as x,a as n,c as S,w,b as e,f as b,v,e as a,g as l,t as i,h as g,D as E,F as C,q as I,x as B,k as F}from"./app.ccec1e18.js";import{_ as q}from"./GenericLayout.8882146b.js";import{_ as A}from"./_plugin-vue_export-helper.cdc0426e.js";import"./app.min.c51efb0b.js";const r=d=>(I("data-v-d96eec2e"),d=d(),B(),d),P=r(()=>e("div",{class:"mb-4"},[e("nav",{"aria-label":"breadcrumb"},[e("ol",{class:"breadcrumb"},[e("li",{class:"breadcrumb-item"},[e("a",{href:"#"},[e("i",{class:"bi bi-globe2 small me-2"}),F(" Dashboard ")])]),e("li",{class:"breadcrumb-item active","aria-current":"page"},"Checkout")])])],-1)),T={class:"row"},j={class:"col-md-8"},D=r(()=>e("h3",{id:"checkout-form-wizard-h-0",class:"title current"},"Billing",-1)),O={class:"card card-body mb-0 body current"},V=r(()=>e("div",{class:"mb-4"},[e("div",{class:"text-muted"},"Enter your billing information")],-1)),L={class:"row g-4 mb-3"},N={class:"col-md-6"},M=r(()=>e("label",{class:"form-label"},"Contact Phone",-1)),$={key:0,class:"invalid-feedback"},z={class:"col-md-6"},R=r(()=>e("label",{class:"form-label"},"Delivery Location",-1)),U={key:0,class:"invalid-feedback"},H={class:"col-md-4"},J=r(()=>e("h5",{class:"mb-4"},"Order Summary",-1)),K={class:"card mb-4"},Q={class:"card-body"},Y=r(()=>e("h6",{class:"card-title mb-4"},"Products",-1)),G={class:"list-group list-group-flush"},W=r(()=>e("a",{href:"#",class:"me-3"},[e("img",{src:"#",class:"rounded",width:"60",alt:"..."})],-1)),X={class:"text-end ms-auto"},Z={class:"card mb-4"},ee={class:"card-body"},te=r(()=>e("h6",{class:"card-title mb-4"},"Price",-1)),se={class:"row justify-content-center mb-3"},oe=r(()=>e("div",{class:"col-4 text-end"},"Sub Total :",-1)),ce={class:"col-4"},re=r(()=>e("div",{class:"row justify-content-center mb-3"},[e("div",{class:"col-4 text-end"},"Shipping :"),e("div",{class:"col-4"},"Free")],-1)),ae={class:"row justify-content-center"},ie=r(()=>e("div",{class:"col-4 text-end"},[e("strong",null,"Total :")],-1)),ne={class:"col-4"},de={__name:"Checkout",setup(d){const u=localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):null,t=y({location:"",phone_number:"",distributor_address_id:null,distributor_packages:[]});let _=k(0);const m=o=>{let s=0,c=0,h=o.discounts.length?(100-o.discounts[0].percentage)/100:0;return o.product_options.forEach(p=>{c+=parseFloat(p.price),s+=parseFloat(p.price)}),s=h?h*s:s,[s,c]},f=()=>{if(t.clearErrors(),(!t.location||t.location.trim()=="")&&!t.distributor_address_id&&t.setError("location","delivery location is required"),(!t.phone_number||t.phone_number.trim()=="")&&!t.distributor_address_id&&t.setError("phone_number","phone number field is required"),t.errors&&Object.keys(t.errors).length)return;const o=document.getElementById("submitBtn");o.innerText="Checking out...",o.setAttribute("disabled",!0),t.post("/orders",{onSuccess:()=>{localStorage.removeItem("cart")},onError:()=>{o.innerText="Place Order"},onFinish:()=>{o.innerText="Checking out...",o.removeAttribute("disabled")}})};return x(()=>{u&&u.forEach(s=>{_.value+=m(s.distributor_package)[0]*parseInt(s.qty),t.distributor_packages.push({id:s.distributor_package.id,qty:s.qty})});let o=document.createElement("script");o.setAttribute("src","https://maps.googleapis.com/maps/api/js?key=AIzaSyBoR-KFcg8yHE4-x5xw4ixAQxYhkPbM4Tc&libraries=places"),document.head.appendChild(o),o.addEventListener("load",function(){const s=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{componentRestrictions:{country:"ke"}});google.maps.event.addListener(s,"place_changed",function(c){t.location=`${s.getPlace().name} ${s.getPlace().formatted_address}`})})}),(o,s)=>(n(),S(q,null,{default:w(()=>[P,e("div",T,[e("div",j,[D,e("section",O,[V,e("div",L,[e("div",N,[M,b(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=c=>a(t).phone_number=c)},null,512),[[v,a(t).phone_number]]),a(t).errors.phone_number?(n(),l("div",$,i(a(t).errors.phone_number),1)):g("",!0)]),e("div",z,[R,b(e("input",{id:"autocomplete",type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=c=>a(t).location=c)},null,512),[[v,a(t).location]]),a(t).errors.location?(n(),l("div",U,i(a(t).errors.location),1)):g("",!0)])])])]),e("div",H,[J,e("div",K,[e("div",Q,[Y,e("div",G,[(n(!0),l(C,null,E(a(u),c=>(n(),l("div",{key:c.distributor_package.id,class:"list-group-item d-flex px-0"},[W,e("div",null,[e("h6",null,i(c.distributor_package.name),1),e("div",null,i(c.qty)+" x ksh."+i(m(c.distributor_package)[0]),1)]),e("div",X,"ksh."+i(m(c.distributor_package)[0]*c.qty),1)]))),128))])])]),e("div",Z,[e("div",ee,[te,e("div",se,[oe,e("div",ce,"ksh."+i(a(_)),1)]),re,e("div",ae,[ie,e("div",ne,[e("strong",null,"ksh."+i(a(_)),1)])])])]),e("div",{class:"card"},[e("div",{class:"card-body"},[e("button",{onClick:f,id:"submitBtn",class:"btn btn-outline-primary btn-icon"}," Checkout ")])])])])]),_:1}))}},he=A(de,[["__scopeId","data-v-d96eec2e"]]);export{he as default};
