import{r as c,u as B,o as A,$ as D,a as u,c as U,w as v,b as e,d as f,e as n,f as k,v as x,g as p,t as _,h as b,p as $,i as E,F as C,k as F}from"./app.841bdbec.js";import{e as S,D as P}from"./dataTables.bootstrap5.569cfce1.js";import"./dataTables.responsive.5d2b5004.js";import{i as V}from"./index.e5f3f49b.js";import{_ as M}from"./GenericLayout.1112522b.js";import{_ as I}from"./ModalComponent.521dc2fa.js";import"./app.min.88f755a3.js";import"./index.52a0c4ef.js";import"./_plugin-vue_export-helper.cdc0426e.js";const j={class:"card"},L=e("div",{class:"card-header"},[e("h5",null,"Discounts"),e("button",{type:"button",id:"modalBtn","data-bs-toggle":"modal","data-bs-target":"#exampleModal",class:"btn btn-icon btn-primary"},[e("i",{class:"bi bi-plus-circle"}),F(" Add Discount ")])],-1),O={class:"card-body"},K=e("thead",null,[e("tr",null,[e("th",null,"Product Name"),e("th",null,"Percentage"),e("th",null,"Start Date"),e("th",null,"End Date"),e("th",null,"Status"),e("th",null,"Created At"),e("th",null,"Actions")])],-1),R=["onSubmit"],z={class:"row mb-3"},G={class:"col"},H={class:"form-group"},J=e("label",{class:"mb-2",for:"product name"},"Product Name",-1),Q={key:0,class:"invalid-feedback"},W=["onClick"],X={class:"row mb-3"},Y={class:"col"},Z={class:"form-group"},ee=e("label",{class:"mb-2",for:"discount percentage"},"Discount Percentage",-1),te={key:0,class:"invalid-feedback"},se={class:"row mb-3"},re={class:"col"},ae={class:"form-group"},ne=e("label",{for:"",class:"mb-2"},"Discount Duration",-1),oe=e("br",null,null,-1),de={key:0,class:"invalid-feedback"},le={class:"form-group mt-4"},ie=e("button",{type:"button",class:"btn btn-danger",style:{"margin-right":"10px"},"data-bs-dismiss":"modal"},"Close",-1),ue={id:"submitBtn",type:"submit",class:"btn btn-primary"},ye={__name:"Discounts",props:{discounts:Array},setup(h){const q=h;S.use(P);const l=c(""),o=c(""),i=c(!1),d=c(null),m=c([]),t=B({product_id:"",percentage:""});let g;const N=()=>{if(clearTimeout(g),!l.value||l.value.trim()==""){m.value=[],t.clearErrors("query");return}g=setTimeout(function(){t.clearErrors("query"),fetch("/products/search/"+l.value).then(r=>r.json()).then(r=>{if(!r.results.length){t.setError("query","searched product not found");return}m.value=r.results}).catch(r=>console.log("product search err: "+r))},500)},T=()=>{if(t.clearErrors(),!o.value.length||!o.value?t.setError("start_date","discount duration is required"):o.value[0]?o.value[1]||t.setError("end_date","end date is required"):t.setError("start_date","start date is required"),(!t.product_id||parseInt(t.product_id)===NaN)&&t.setError("query","product field is required"),(!t.percentage||parseFloat(t.percentage)===NaN)&&t.setError("percentage","percentage field is required"),t.errors&&Object.keys(t.errors).length)return;const r=document.getElementById("submitBtn");i.value?(r.innerText="Updating....",t.transform(a=>({...a,start_date:o.value[0],end_date:o.value[1]})).put(`/discounts/${d.value.id}`,{onSuccess(){r.innerText="Save",i.value=!1,d.value=null,t.reset()},onError(){r.innerText="Update"}})):(r.innerText="Saving....",t.transform(a=>({...a,start_date:o.value[0],end_date:o.value[1]})).post("/discounts",{onSuccess(){t.reset()},onFinish(){r.innerText="Save"}}))},w=r=>{t.product_id=r.id,l.value=r.name,m.value=[]};return A(()=>{document.getElementById("dt").addEventListener("click",function(r){if(r.target.nodeName!=="BUTTON")return;const a=r.target.getAttribute("data-id"),s=r.target.getAttribute("data-type");s==="del"?confirm("Are you sure you want to delete this discount?")&&t.delete(`/discounts/${a}`):s==="edit"&&(d.value=q.discounts.filter(({id:y})=>y==a)[0],t.percentage=d.value.percentage,t.product_id=d.value.product_id,l.value=d.value.product.name,o.value=[d.value.start_date,d.value.end_date],i.value=!0,D("#modalBtn").click())}),D("#exampleModal").on("hide.bs.modal",function(){i.value&&(i.value=!1,d.value=null)})}),(r,a)=>(u(),U(M,null,{default:v(()=>[e("div",j,[L,e("div",O,[f(n(S),{id:"dt",class:"display table table-responsive",options:{responsive:!0},data:h.discounts,columns:[{data:"product",render:s=>s.name},{data:"percentage"},{data:"start_date",render:s=>new Date(s).toDateString()},{data:"end_date",render:s=>new Date(s).toDateString()},{data:"active",render:s=>{if(s===1)return"<span class='badge bg-success'>Active</span>";if(s===1)return"<span class='badge bg-success'>Active</span>"}},{data:"created_at",render:s=>new Date(s).toDateString()},{data:null,render:s=>`<button data-type=edit data-id=${s.id} class='btn btn-sm btn-secondary mr-3'>Edit</button> <button data-type=del data-id=${s.id} class='btn btn-sm btn-danger'>Delete</button>`}]},{default:v(()=>[K]),_:1},8,["data","columns"])])]),f(I,{title:i.value?"Update Discount":"Add Discount"},{default:v(()=>[e("form",{onSubmit:E(T,["prevent"])},[e("div",z,[e("div",G,[e("div",H,[J,k(e("input",{type:"text",onKeyup:N,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value=s),placeholder:"Search for product....",class:"form-control"},null,544),[[x,l.value]]),n(t).errors.query?(u(),p("div",Q,_(n(t).errors.query),1)):b("",!0)]),(u(!0),p(C,null,$(m.value,s=>(u(),p("div",{class:"list-group",key:s.id},[e("a",{href:"#",onClick:E(y=>w(s),["prevent"]),class:"list-group-item"},_(s.name),9,W)]))),128))])]),e("div",X,[e("div",Y,[e("div",Z,[ee,k(e("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>n(t).percentage=s),class:"form-control"},null,512),[[x,n(t).percentage]]),n(t).errors.percentage?(u(),p("div",te,_(n(t).errors.percentage),1)):b("",!0)])])]),e("div",se,[e("div",re,[e("div",ae,[ne,oe,f(n(V),{type:"datetime",range:"",value:o.value,"onUpdate:value":a[2]||(a[2]=s=>o.value=s)},null,8,["value"]),n(t).errors.start_date||n(t).errors.end_date?(u(),p("div",de,_(n(t).errors.start_date?n(t).errors.start_date:n(t).errors.end_date),1)):b("",!0)])])]),e("div",le,[ie,e("button",ue,_(i.value?"Update":"Save"),1)])],40,R)]),_:1},8,["title"])]),_:1}))}};export{ye as default};
