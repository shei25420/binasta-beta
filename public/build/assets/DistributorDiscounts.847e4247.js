import{r as u,u as A,o as q,$ as k,a as c,c as $,w as v,b as e,d as b,e as n,f as D,v as x,g as _,t as p,h as g,p as U,i as S,F as C,k as F}from"./app.2dfc48f0.js";import{_ as V}from"./GenericLayout.f583260a.js";import{_ as M}from"./ModalComponent.d91dfeff.js";import{e as E,D as P}from"./dataTables.bootstrap5.3db25059.js";import{i as I}from"./index.4ceee5e4.js";import"./app.min.43ffa372.js";import"./index.37b1d19b.js";import"./_plugin-vue_export-helper.cdc0426e.js";const j={class:"card"},L=e("div",{class:"card-header"},[e("h5",null,"Distributors Discounts"),e("button",{type:"button",id:"modalBtn","data-bs-toggle":"modal","data-bs-target":"#exampleModal",class:"btn btn-icon btn-primary"},[e("i",{class:"bi bi-plus-circle"}),F(" Add Discount ")])],-1),O={class:"card-body"},K=e("thead",null,[e("tr",null,[e("th",null,"Package Name"),e("th",null,"Percentage"),e("th",null,"Start Date"),e("th",null,"End Date"),e("th",null,"Status"),e("th",null,"Created At"),e("th",null,"Actions")])],-1),R=["onSubmit"],z={class:"row mb-3"},G={class:"col"},H={class:"form-group"},J=e("label",{class:"mb-2",for:"product name"},"Package Name",-1),Q={key:0,class:"invalid-feedback"},W=["onClick"],X={class:"row mb-3"},Y={class:"col"},Z={class:"form-group"},ee=e("label",{class:"mb-2",for:"discount percentage"},"Discount Percentage",-1),te={key:0,class:"invalid-feedback"},ae={class:"row mb-3"},se={class:"col"},re={class:"form-group"},ne=e("label",{for:"",class:"mb-2"},"Discount Duration",-1),oe=e("br",null,null,-1),ie={key:0,class:"invalid-feedback"},de={class:"form-group mt-4"},le=e("button",{type:"button",class:"btn btn-danger",style:{"margin-right":"10px"},"data-bs-dismiss":"modal"},"Close",-1),ue={id:"submitBtn",type:"submit",class:"btn btn-primary"},he={__name:"DistributorDiscounts",props:{discounts:Array},setup(f){const N=f;E.use(P);const d=u(""),o=u(""),l=u(!1),i=u(null),m=u([]);let h=u(null);const t=A({distributor_package_id:"",percentage:""}),T=()=>{if(clearTimeout(h),!d.value||d.value.trim()==""){m.value=[];return}h=setTimeout(()=>{fetch(`/distributor_packages/${d.value}`).then(s=>s.json()).then(s=>m.value=s.results).catch(s=>console.log("search distributor pacakges: ",s))},500)},w=s=>{t.distributor_package_id=s.id,d.value=s.name,m.value=[]},B=()=>{if(t.clearErrors(),!o.value.length||!o.value?t.setError("start_date","discount duration is required"):o.value[0]?o.value[1]||t.setError("end_date","end date is required"):t.setError("start_date","start date is required"),(!t.distributor_package_id||parseInt(t.distributor_package_id)===NaN)&&t.setError("query","package name field is required"),(!t.percentage||parseFloat(t.percentage)===NaN)&&t.setError("percentage","percentage field is required"),t.errors&&Object.keys(t.errors).length)return;const s=document.getElementById("submitBtn");l.value?(s.innerText="Updating....",t.transform(r=>({...r,start_date:o.value[0],end_date:o.value[1]})).put(`/distributor_discounts/${i.value.id}`,{onSuccess(){s.innerText="Save",l.value=!1,i.value=null,t.reset()},onError(){s.innerText="Update"}})):(s.innerText="Saving....",t.transform(r=>({...r,start_date:o.value[0],end_date:o.value[1]})).post("/distributor_discounts",{onSuccess(){t.reset()},onFinish(){s.innerText="Save"}}))};return q(()=>{document.getElementById("dt").addEventListener("click",function(s){if(s.target.nodeName!=="BUTTON")return;const r=s.target.getAttribute("data-id"),a=s.target.getAttribute("data-type");a==="del"?confirm("Are you sure you want to delete this discount?")&&t.delete(`/distributor_discounts/${r}`):a==="edit"&&(i.value=N.discounts.filter(({id:y})=>y==r)[0],t.percentage=i.value.percentage,t.distributor_package_id=i.value.distributor_package_id,d.value=i.value.distributor_package.name,o.value=[i.value.start_date,i.value.end_date],console.log(o.value),l.value=!0,k("#modalBtn").click())}),k("#exampleModal").on("hide.bs.modal",function(){l.value&&(l.value=!1,i.value=null)})}),(s,r)=>(c(),$(V,null,{default:v(()=>[e("div",j,[L,e("div",O,[b(n(E),{id:"dt",class:"display table table-responsive",data:f.discounts,columns:[{data:"distributor_package",render:a=>a.name},{data:"percentage"},{data:"start_date",render:a=>new Date(a).toDateString()},{data:"end_date",render:a=>new Date(a).toDateString()},{data:"active",render:a=>{if(a===1)return"<span class='badge bg-success'>Active</span>";if(a===1)return"<span class='badge bg-success'>Active</span>"}},{data:"created_at",render:a=>new Date(a).toDateString()},{data:null,render:a=>`<button data-type=edit data-id=${a.id} class='btn btn-sm btn-secondary mr-3'>Edit</button> <button data-type=del data-id=${a.id} class='btn btn-sm btn-danger'>Delete</button>`}]},{default:v(()=>[K]),_:1},8,["data","columns"])])]),b(M,{title:l.value?"Update Discount":"Add Discount"},{default:v(()=>[e("form",{onSubmit:S(B,["prevent"])},[e("div",z,[e("div",G,[e("div",H,[J,D(e("input",{type:"text",onKeyup:T,"onUpdate:modelValue":r[0]||(r[0]=a=>d.value=a),placeholder:"Search for package....",class:"form-control"},null,544),[[x,d.value]]),n(t).errors.query?(c(),_("div",Q,p(n(t).errors.query),1)):g("",!0)]),(c(!0),_(C,null,U(m.value,a=>(c(),_("div",{class:"list-group",key:a.id},[e("a",{href:"#",onClick:S(y=>w(a),["prevent"]),class:"list-group-item"},p(a.name),9,W)]))),128))])]),e("div",X,[e("div",Y,[e("div",Z,[ee,D(e("input",{type:"text","onUpdate:modelValue":r[1]||(r[1]=a=>n(t).percentage=a),class:"form-control"},null,512),[[x,n(t).percentage]]),n(t).errors.percentage?(c(),_("div",te,p(n(t).errors.percentage),1)):g("",!0)])])]),e("div",ae,[e("div",se,[e("div",re,[ne,oe,b(n(I),{type:"datetime",range:"",value:o.value,"onUpdate:value":r[2]||(r[2]=a=>o.value=a)},null,8,["value"]),n(t).errors.start_date||n(t).errors.end_date?(c(),_("div",ie,p(n(t).errors.start_date?n(t).errors.start_date:n(t).errors.end_date),1)):g("",!0)])])]),e("div",de,[le,e("button",ue,p(l.value?"Update":"Save"),1)])],40,R)]),_:1},8,["title"])]),_:1}))}};export{he as default};
