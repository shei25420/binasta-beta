import{u as f,r as v,o as k,z as w,a as d,c as E,w as T,b as e,t as n,k as b,g as p,p as O,F,e as l,f as D,v as C,h as y,n as P,i as R}from"./app.22054bab.js";import{_ as B,a as I}from"./GenericLayout.578c2905.js";import"./app.min.b01178a0.js";import"./index.384e00db.js";import"./_plugin-vue_export-helper.cdc0426e.js";const S={class:"card"},N={class:"card-body"},j={class:"invoice"},A={class:"d-md-flex justify-content-between align-items-center mb-4"},q=e("div",{class:"d-md-flex justify-content-between align-items-center"},[e("h4",null,"Invoice"),e("div",null,[e("img",{width:"120",src:I,alt:"logo"})])],-1),M=e("hr",{class:"my-4"},null,-1),X={class:"row"},V={class:"col-md-6"},J=e("p",{class:"text-start"},[e("strong",null,"Bill to")],-1),U={class:"mb-2"},K=e("br",null,null,-1),G={class:"table-responsive",tabindex:"1",style:{overflow:"hidden",outline:"none"}},W={class:"table mb-4 mt-4"},$=e("thead",{class:"thead-light"},[e("tr",null,[e("th",null,"Package"),e("th",{class:"text-end"},"Quantity"),e("th",{class:"text-end"},"Price"),e("th",{class:"text-end"},"Total")])],-1),z={class:"text-start"},H={class:"row"},L={key:0,class:"col-md-6"},Y={class:"accordion accordion-with-radio",id:"accordionExample"},Q={class:"accordion-item"},Z={class:"accordion-header",id:"headingOne"},ee=e("div",{class:"form-check"},[e("input",{class:"form-check-input",type:"radio",name:"paymentFlexRadioDefault",id:"paypalFlexRadioDefault"}),e("label",{class:"form-check-label mb-0",for:"paypalFlexRadioDefault"}," Pay with Paypal ")],-1),te=[ee],se=e("div",{class:"accordion-body"},[e("div",{class:"col-md-12"},[e("img",{width:"50",class:"me-3",src:"#",alt:"..."}),e("div",{id:"paypalContainer",class:"col-sm-12"}),b(" You will be redirected to PayPal website to complete your purchase securely. ")])],-1),oe=[se],ae={class:"accordion-item"},ne=e("h2",{class:"accordion-header",id:"headingThree"},[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseThree","aria-expanded":"false","aria-controls":"collapseThree"},[e("div",{class:"form-check"},[e("input",{class:"form-check-input",type:"radio",name:"paymentFlexRadioDefault",id:"cashOnDeliveryFlexRadioDefault"}),e("label",{class:"form-check-label mb-0",for:"cashOnDeliveryFlexRadioDefault"}," Pay with Mpesa ")])])],-1),re={id:"collapseThree",class:"accordion-collapse collapse","aria-labelledby":"headingThree","data-bs-parent":"#accordionExample"},le={class:"accordion-body"},ie={class:"d-flex align-items-center"},ce={class:"input-group mb-3"},de=e("div",{class:"input-group-prepend"},[e("span",{style:{padding:"11px"},class:"input-group-text",id:"basic-addon1"},[e("strong",null,"+254")])],-1),pe={key:0,class:"invalid-feedback"},me={class:"form-group"},ue=["onClick"],he={class:"col-md-6"},_e={class:"text-end"},ye=e("p",null,"Shipping: Free",-1),be={class:"fw-bold"},we={__name:"Invoice",props:{order:Object},setup(i){const h=i,s=f({phone_number:"",payment_type:"mpesa",order_ref:h.order.ref});let c=v(null);const g=f({order_ref:h.order.ref});let m=v(0);const _=r=>{let t=0,o=0,a=r.discounts.length?(100-r.discounts[0].percentage)/100:0;return r.product_options.forEach(u=>{o+=parseFloat(u.price)*parseInt(u.min),t+=parseFloat(u.price)*parseInt(u.min)}),t=a?a*t:t,[t,o]},x=()=>{if(console.log(s.payment_type),s.clearErrors(),c.value=null,!s.phone_number||s.phone_number.trim()==""?s.setError("phone_number","Phone number is required"):s.phone_number.length>9&&s.setError("phone_number","Phone number is invalid. (Hint) Don't start with 0"),(!s.payment_type||s.payment_type.trim()=="")&&s.setError("payment_type","payment type is required"),(!s.order_ref||s.order_ref.trim()=="")&&s.setError("order_ref","Order ref is requireed"),s.errors&&Object.keys(s.errors).length)return;const r=document.getElementById("submitBtn");r.innerText="Making payment....",r.setAttribute("disabled",!0),fetch("/make_payment",{method:"POST",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(t=>t.startsWith("XSRF-TOKEN="))[0].split("=")[1])},body:JSON.stringify({phone_number:s.phone_number,payment_type:s.payment_type,order_ref:s.order_ref})}).then(t=>t.json()).then(t=>console.log(t)).catch(t=>console.log(t))};return k(()=>{h.order.distributor_packages.forEach(t=>{m.value=_(t)[0],m.value*=t.quantity});let r=document.createElement("script");r.setAttribute("src","https://www.paypal.com/sdk/js?client-id=AaYT0UqlwWovXoGEp6qqBalZR32nG5gDXRVU546jy4_Gv_JrpRAF6fB8xp3gJ7cOTNmHJ-NVhAO4DxIC"),document.head.appendChild(r),r.addEventListener("load",()=>{paypal.Buttons({createOrder:async(t,o)=>fetch("/make_payment",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(a=>a.startsWith("XSRF-TOKEN"))[0].split("=")[1])},body:JSON.stringify({payment_type:s.payment_type,order_ref:s.order_ref})}).then(a=>a.json()).then(a=>a.orderId).catch(a=>console.log("make payment paypal err",a)),onApprove:(t,o)=>{g.transform(a=>({...a,ref:t.orderID})).post("/capture/paypal",{onError:a=>{console.log("paypal capture err",a)}})}}).render("#paypalContainer")}),window.Echo.private(`distributor_payments.${w().props.value.auth.user.id}`).listen("MpesaPaymentCaptured",t=>{if(console.log(t),c.value={message:t.message},parseInt(t.status)===0)c.value.class="primary",window.location.href="https://dashboard.binasta.co.ke/orders";else{c.value.class="danger";const o=document.getElementById("submitBtn");o.removeAttribute("disabled"),o.innerText="Make payment"}})}),(r,t)=>(d(),E(B,null,{default:T(()=>[e("div",S,[e("div",N,[e("div",j,[e("div",A,[e("div",null,"Invoice No : #"+n(i.order.ref),1),e("div",null,"Date: "+n(new Date(i.order.created_at).toDateString()),1)]),q,M,e("div",X,[e("div",V,[J,e("p",U,n(i.order.distributor.first_name)+" "+n(i.order.distributor.last_name),1),e("p",null,[b(n(i.order.location)+", ",1),K,b(n(i.order.phone_number),1)])])]),e("div",G,[e("table",W,[$,e("tbody",null,[(d(!0),p(F,null,O(i.order.distributor_packages,o=>(d(),p("tr",{class:"text-end",key:o.id},[e("td",z,n(o.name),1),e("td",null,n(o.quantity),1),e("td",null,"ksh."+n(_(o)[0]),1),e("td",null,"ksh."+n(_(o)[1]*o.quantity),1)]))),128))])])]),e("div",H,[i.order.status==0?(d(),p("div",L,[e("div",Y,[e("div",Q,[e("h2",Z,[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOne","aria-expanded":"false","aria-controls":"collapseOne",onClick:t[0]||(t[0]=()=>l(s).payment_type="paypal")},te)]),e("div",{id:"collapseOne",class:"accordion-collapse collapse","aria-labelledby":"headingOne","data-bs-parent":"#accordionExample",onClick:t[1]||(t[1]=()=>l(s).payment_type="paypal")},oe)]),e("div",ae,[ne,e("div",re,[e("div",le,[e("div",ie,[e("div",ce,[de,D(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>l(s).phone_number=o),placeholder:"Enter phone number",class:"form-control"},null,512),[[C,l(s).phone_number]])]),l(s).errors.phone_number?(d(),p("div",pe,n(l(s).errors.phone_number),1)):y("",!0),l(c)?(d(),p("div",{key:1,class:P(`alert alert-${l(c).class}`),role:"alert"},[e("strong",null,n(l(c).message),1)],2)):y("",!0)]),e("div",me,[e("button",{onClick:R(x,["prevent"]),id:"submitBtn",class:"btn btn-primary"},"Make Payment",8,ue)])])])])])])):y("",!0),e("div",he,[e("div",_e,[e("p",null,"Sub Total: ksh."+n(l(m)),1),ye,e("h4",be,"Total: ksh."+n(l(m)),1)])])])])])])]),_:1}))}};export{we as default};
