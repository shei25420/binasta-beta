import{u as f,r as v,o as k,a as d,c as w,w as E,b as e,t as n,k as b,g as p,p as T,F as O,e as l,f as F,v as D,h as y,n as C,i as P}from"./app.ce457f82.js";import{_ as R,a as B}from"./GenericLayout.8f1189b8.js";import"./app.min.d6281013.js";import"./index.708f271e.js";import"./_plugin-vue_export-helper.cdc0426e.js";const I={class:"card"},S={class:"card-body"},N={class:"invoice"},j={class:"d-md-flex justify-content-between align-items-center mb-4"},A=e("div",{class:"d-md-flex justify-content-between align-items-center"},[e("h4",null,"Invoice"),e("div",null,[e("img",{width:"120",src:B,alt:"logo"})])],-1),q=e("hr",{class:"my-4"},null,-1),M={class:"row"},X={class:"col-md-6"},V=e("p",{class:"text-start"},[e("strong",null,"Bill to")],-1),J={class:"mb-2"},U=e("br",null,null,-1),K={class:"table-responsive",tabindex:"1",style:{overflow:"hidden",outline:"none"}},G={class:"table mb-4 mt-4"},W=e("thead",{class:"thead-light"},[e("tr",null,[e("th",null,"Package"),e("th",{class:"text-end"},"Quantity"),e("th",{class:"text-end"},"Price"),e("th",{class:"text-end"},"Total")])],-1),$={class:"text-start"},H={class:"row"},L={key:0,class:"col-md-6"},Y={class:"accordion accordion-with-radio",id:"accordionExample"},z={class:"accordion-item"},Q={class:"accordion-header",id:"headingOne"},Z=e("div",{class:"form-check"},[e("input",{class:"form-check-input",type:"radio",name:"paymentFlexRadioDefault",id:"paypalFlexRadioDefault"}),e("label",{class:"form-check-label mb-0",for:"paypalFlexRadioDefault"}," Pay with Paypal ")],-1),ee=[Z],te=e("div",{class:"accordion-body"},[e("div",{class:"col-md-12"},[e("img",{width:"50",class:"me-3",src:"#",alt:"..."}),e("div",{id:"paypalContainer",class:"col-sm-12"}),b(" You will be redirected to PayPal website to complete your purchase securely. ")])],-1),se=[te],oe={class:"accordion-item"},ae=e("h2",{class:"accordion-header",id:"headingThree"},[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseThree","aria-expanded":"false","aria-controls":"collapseThree"},[e("div",{class:"form-check"},[e("input",{class:"form-check-input",type:"radio",name:"paymentFlexRadioDefault",id:"cashOnDeliveryFlexRadioDefault"}),e("label",{class:"form-check-label mb-0",for:"cashOnDeliveryFlexRadioDefault"}," Pay with Mpesa ")])])],-1),ne={id:"collapseThree",class:"accordion-collapse collapse","aria-labelledby":"headingThree","data-bs-parent":"#accordionExample"},re={class:"accordion-body"},le={class:"d-flex align-items-center"},ie={class:"input-group mb-3"},ce=e("div",{class:"input-group-prepend"},[e("span",{style:{padding:"11px"},class:"input-group-text",id:"basic-addon1"},[e("strong",null,"+254")])],-1),de={key:0,class:"invalid-feedback"},pe={class:"form-group"},me=["onClick"],ue={class:"col-md-6"},he={class:"text-end"},_e=e("p",null,"Shipping: Free",-1),ye={class:"fw-bold"},ke={__name:"Invoice",props:{order:Object},setup(i){const h=i,s=f({phone_number:"",payment_type:"mpesa",order_ref:h.order.ref});let c=v(null);const g=f({order_ref:h.order.ref});let m=v(0);const _=r=>{let t=0,o=0,a=r.discounts.length?(100-r.discounts[0].percentage)/100:0;return r.product_options.forEach(u=>{o+=parseFloat(u.price)*parseInt(u.min),t+=parseFloat(u.price)*parseInt(u.min)}),t=a?a*t:t,[t,o]},x=()=>{if(console.log(s.payment_type),s.clearErrors(),c.value=null,!s.phone_number||s.phone_number.trim()==""?s.setError("phone_number","Phone number is required"):s.phone_number.length>9&&s.setError("phone_number","Phone number is invalid. (Hint) Don't start with 0"),(!s.payment_type||s.payment_type.trim()=="")&&s.setError("payment_type","payment type is required"),(!s.order_ref||s.order_ref.trim()=="")&&s.setError("order_ref","Order ref is requireed"),s.errors&&Object.keys(s.errors).length)return;const r=document.getElementById("submitBtn");r.innerText="Making payment....",r.setAttribute("disabled",!0),fetch("/make_payment",{method:"POST",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(t=>t.startsWith("XSRF-TOKEN="))[0].split("=")[1])},body:JSON.stringify({phone_number:s.phone_number,payment_type:s.payment_type,order_ref:s.order_ref})}).then(t=>t.json()).then(t=>console.log(t)).catch(t=>console.log(t))};return k(()=>{h.order.distributor_packages.forEach(t=>{m.value=_(t)[0],m.value*=t.quantity});let r=document.createElement("script");r.setAttribute("src","https://www.paypal.com/sdk/js?client-id=AaYT0UqlwWovXoGEp6qqBalZR32nG5gDXRVU546jy4_Gv_JrpRAF6fB8xp3gJ7cOTNmHJ-NVhAO4DxIC"),document.head.appendChild(r),r.addEventListener("load",()=>{paypal.Buttons({createOrder:async(t,o)=>fetch("/make_payment",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(a=>a.startsWith("XSRF-TOKEN"))[0].split("=")[1])},body:JSON.stringify({payment_type:s.payment_type,order_ref:s.order_ref})}).then(a=>a.json()).then(a=>a.orderId).catch(a=>console.log("make payment paypal err",a)),onApprove:(t,o)=>{g.transform(a=>({...a,ref:t.orderID})).post("/capture/paypal",{onError:a=>{console.log("paypal capture err",a)}})}}).render("#paypalContainer")}),window.Echo.private(`payments.${usePage().props.value.auth.user.id}`).listen("MpesaPaymentCaptured",t=>{if(c.value={message:t.message},parseInt(t.status)===0)c.value.class="primary",window.location.href="https://dashboard.binasta.co.ke/orders";else{c.value.class="danger";const o=document.getElementById("submitBtn");o.removeAttribute("disabled"),o.innerText="Make payment"}})}),(r,t)=>(d(),w(R,null,{default:E(()=>[e("div",I,[e("div",S,[e("div",N,[e("div",j,[e("div",null,"Invoice No : #"+n(i.order.ref),1),e("div",null,"Date: "+n(new Date(i.order.created_at).toDateString()),1)]),A,q,e("div",M,[e("div",X,[V,e("p",J,n(i.order.distributor.first_name)+" "+n(i.order.distributor.last_name),1),e("p",null,[b(n(i.order.location)+", ",1),U,b(n(i.order.phone_number),1)])])]),e("div",K,[e("table",G,[W,e("tbody",null,[(d(!0),p(O,null,T(i.order.distributor_packages,o=>(d(),p("tr",{class:"text-end",key:o.id},[e("td",$,n(o.name),1),e("td",null,n(o.quantity),1),e("td",null,"ksh."+n(_(o)[0]),1),e("td",null,"ksh."+n(_(o)[1]*o.quantity),1)]))),128))])])]),e("div",H,[i.order.status==0?(d(),p("div",L,[e("div",Y,[e("div",z,[e("h2",Q,[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOne","aria-expanded":"false","aria-controls":"collapseOne",onClick:t[0]||(t[0]=()=>l(s).payment_type="paypal")},ee)]),e("div",{id:"collapseOne",class:"accordion-collapse collapse","aria-labelledby":"headingOne","data-bs-parent":"#accordionExample",onClick:t[1]||(t[1]=()=>l(s).payment_type="mpesa")},se)]),e("div",oe,[ae,e("div",ne,[e("div",re,[e("div",le,[e("div",ie,[ce,F(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>l(s).phone_number=o),placeholder:"Enter phone number",class:"form-control"},null,512),[[D,l(s).phone_number]])]),l(s).errors.phone_number?(d(),p("div",de,n(l(s).errors.phone_number),1)):y("",!0),l(c)?(d(),p("div",{key:1,class:C(`alert alert-${l(c).class}`),role:"alert"},[e("strong",null,n(l(c).message),1)],2)):y("",!0)]),e("div",pe,[e("button",{onClick:P(x,["prevent"]),id:"submitBtn",class:"btn btn-primary"},"Make Payment",8,me)])])])])])])):y("",!0),e("div",ue,[e("div",he,[e("p",null,"Sub Total: ksh."+n(l(m)),1),_e,e("h4",ye,"Total: ksh."+n(l(m)),1)])])])])])])]),_:1}))}};export{ke as default};
