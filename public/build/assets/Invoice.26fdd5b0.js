import{r as f,u as b,o as C,z as R,a as p,g as _,b as e,d as g,w as k,e as o,t as i,k as h,F as S,p as N,f as m,a1 as x,X as w,v as O,h as v,n as B,i as F,q as D,L as E,x as P,y as q}from"./app.31ce84c9.js";import{_ as A}from"./flogo.b45e8d3c.js";import{_ as M,a as V,b as j,c as U,d as X}from"./icon-youtube-white.12f5965b.js";import{_ as J}from"./_plugin-vue_export-helper.cdc0426e.js";const c=n=>(P("data-v-d759acea"),n=n(),q(),n),L={class:"invoice invoice-content invoice-1"},G={class:"back-top-home hover-up mt-30 ml-30"},K=c(()=>e("i",{class:"fi-rs-home mr-5"},null,-1)),H={class:"container"},W={class:"row"},z={class:"col-lg-12"},$={class:"invoice-inner"},Q={class:"invoice-info",id:"invoice_wrapper"},Y={class:"invoice-header"},Z={class:"row"},ee={class:"col-sm-6"},te={class:"invoice-name"},se={class:"logo"},ae=c(()=>e("img",{width:"200",src:A,alt:"logo"},null,-1)),oe={class:"col-sm-6"},ne={class:"invoice-numb"},ie={class:"text-end mb-10 mt-20"},re={class:"text-end invoice-header-1"},ce={class:"invoice-top"},de={class:"row"},le={class:"col-lg-9 col-md-6"},pe={class:"invoice-number"},_e=c(()=>e("h4",{class:"invoice-title-1 mb-10"},"Invoice To",-1)),me={class:"invoice-addr-1"},he=c(()=>e("br",null,null,-1)),ue=c(()=>e("br",null,null,-1)),ve={class:"invoice-center"},ye={class:"table-responsive"},fe={class:"table table-striped invoice-table"},be=c(()=>e("thead",{class:"bg-active"},[e("tr",null,[e("th",null,"Item name"),e("th",{class:"text-center"},"Unit Price"),e("th",{class:"text-center"},"Quantity"),e("th",{class:"text-right"},"Amount")])],-1)),ge={class:"item-desc-1"},ke={class:"text-center"},xe={class:"text-center"},we={class:"text-right"},Ee=c(()=>e("td",{colspan:"3",class:"text-end f-w-600"},"Grand Total",-1)),Ie={class:"text-right f-w-600"},Te={class:"invoice-bottom"},Ce={class:"row"},Re={key:0,class:"col-sm-6"},Se={class:"row"},Ne={class:"col-sm-12"},Oe=c(()=>e("h3",{class:"invoice-title-1"},"Payment Method",-1)),Be={action:""},Fe={class:"form-check"},De=c(()=>e("label",{class:"form-check-label",for:"flexRadioDefault1"}," Mpesa ",-1)),Pe={class:"form-check"},qe=c(()=>e("label",{class:"form-check-label",for:"flexRadioDefault2"}," Paypal / Credit Card ",-1)),Ae={class:"col-sm-12"},Me={class:"input-group mb-3"},Ve=c(()=>e("div",{class:"input-group-prepend"},[e("span",{style:{padding:"11px"},class:"input-group-text",id:"basic-addon1"},[e("strong",null,"+254")])],-1)),je={key:0,class:"invalid-feedback"},Ue={class:"form-group"},Xe=["onClick"],Je={id:"paypalContainer",class:"col-sm-12"},Le=D('<div class="col-sm-6 col-offsite" data-v-d759acea><div class="text-end" data-v-d759acea><p class="mb-0 text-13" data-v-d759acea>Thank you for your business</p><p data-v-d759acea><strong data-v-d759acea>Binasta Limited</strong></p><div class="mobile-social-icon mt-50 print-hide" data-v-d759acea><h6 data-v-d759acea>Follow Us</h6><a href="#" data-v-d759acea><img src="'+M+'" alt="" data-v-d759acea></a><a href="#" data-v-d759acea><img src="'+V+'" alt="" data-v-d759acea></a><a href="#" data-v-d759acea><img src="'+j+'" alt="" data-v-d759acea></a><a href="#" data-v-d759acea><img src="'+U+'" alt="" data-v-d759acea></a><a href="#" data-v-d759acea><img src="'+X+'" alt="" data-v-d759acea></a></div></div></div>',1),Ge={__name:"Invoice",props:{order:Object},setup(n){const u=n;let y=f(0),l=f(null);u.order.product_options.forEach(d=>{y.value+=parseInt(d.selling_price)*d.pivot.quantity});const I=b({order_ref:u.order.ref}),t=b({phone_number:"",payment_type:"mpesa",order_ref:u.order.ref}),T=()=>{if(t.clearErrors(),l.value=null,!t.phone_number||t.phone_number.trim()==""?t.setError("phone_number","Phone number is required"):t.phone_number.length>9&&t.setError("phone_number","Phone number is invalid. (Hint) Don't start with 0"),(!t.payment_type||t.payment_type.trim()=="")&&t.setError("payment_type","payment type is required"),(!t.order_ref||t.order_ref.trim()=="")&&t.setError("order_ref","Order ref is requireed"),t.errors&&Object.keys(t.errors).length)return;const d=document.getElementById("submitBtn");d.innerText="Making payment....",d.setAttribute("disabled",!0),fetch("/make_payment",{method:"POST",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(s=>s.startsWith("XSRF-TOKEN="))[0].split("=")[1])},body:JSON.stringify({phone_number:t.phone_number,payment_type:t.payment_type,order_ref:t.order_ref})}).then(s=>s.json()).then(s=>console.log(s)).catch(s=>console.log(s))};return C(()=>{let d=document.createElement("script");d.setAttribute("src","https://www.paypal.com/sdk/js?client-id=AaYT0UqlwWovXoGEp6qqBalZR32nG5gDXRVU546jy4_Gv_JrpRAF6fB8xp3gJ7cOTNmHJ-NVhAO4DxIC"),document.head.appendChild(d),d.addEventListener("load",()=>{paypal.Buttons({createOrder:(s,a)=>fetch("/make_payment",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(r=>r.startsWith("XSRF-TOKEN"))[0].split("=")[1])},body:JSON.stringify({payment_type:t.payment_type,order_ref:t.order_ref})}).then(r=>r.json()).then(r=>r.orderId).catch(r=>console.log("make payment paypal err",r)),onApprove:(s,a)=>{console.log(s),I.transform(r=>({...r,ref:s.orderID})).post("/capture/paypal",{onError:r=>{console.log("paypal capture err",r)}})}}).render("#paypalContainer")}),window.Echo.private(`web.payments.${R().props.value.auth.user.id}`).listen("MpesaPaymentCaptured",s=>{if(l.value={message:s.message},parseInt(s.status)===0)l.value.class="primary",window.location.href="https://dashboard.binasta.co.ke/orders";else{l.value.class="danger";const a=document.getElementById("submitBtn");a.removeAttribute("disabled"),a.innerText="Make payment"}})}),(d,s)=>(p(),_("div",L,[e("div",G,[g(o(E),{class:"hover-up",href:"/"},{default:k(()=>[K,h(" Homepage")]),_:1})]),e("div",H,[e("div",W,[e("div",z,[e("div",$,[e("div",Q,[e("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[e("div",se,[g(o(E),{href:"/"},{default:k(()=>[ae]),_:1})])])]),e("div",oe,[e("div",ne,[e("h6",ie,i(new Date(n.order.created_at).toDateString()),1),e("h6",re,"Invoice No: #"+i(n.order.ref),1)])])])]),e("div",ce,[e("div",de,[e("div",le,[e("div",pe,[_e,e("p",me,[e("strong",null,i(n.order.user.email),1),h(),he,h(" "+i(n.order.phone_number)+" ",1),ue,h(" "+i(n.order.location),1)])])])])]),e("div",ve,[e("div",ye,[e("table",fe,[be,e("tbody",null,[(p(!0),_(S,null,N(n.order.product_options,a=>(p(),_("tr",{key:a.id},[e("td",null,[e("div",ge,[e("span",null,i(a.product.name),1),e("small",null,"REF: "+i(n.order.ref),1)])]),e("td",ke,"ksh."+i(a.selling_price),1),e("td",xe,i(a.pivot.quantity),1),e("td",we,"ksh."+i(a.pivot.quantity*a.selling_price),1)]))),128)),e("tr",null,[Ee,e("td",Ie,"ksh."+i(o(y)),1)])])])])]),e("div",Te,[e("div",Ce,[n.order.status==0?(p(),_("div",Re,[e("div",Se,[e("div",Ne,[e("div",null,[Oe,e("form",Be,[e("div",Fe,[m(e("input",{class:"form-check-input","onUpdate:modelValue":s[0]||(s[0]=a=>o(t).payment_type=a),type:"radio",value:"mpesa",id:"flexRadioDefault1"},null,512),[[x,o(t).payment_type]]),De]),e("div",Pe,[m(e("input",{class:"form-check-input",type:"radio",value:"paypal","onUpdate:modelValue":s[1]||(s[1]=a=>o(t).payment_type=a),id:"flexRadioDefault2"},null,512),[[x,o(t).payment_type]]),qe])])])]),m(e("div",Ae,[e("div",Me,[Ve,m(e("input",{type:"text","onUpdate:modelValue":s[2]||(s[2]=a=>o(t).phone_number=a),placeholder:"Enter phone number",class:"form-control"},null,512),[[O,o(t).phone_number]])]),o(t).errors.phone_number?(p(),_("div",je,i(o(t).errors.phone_number),1)):v("",!0),o(l)?(p(),_("div",{key:1,class:B(`alert alert-${o(l).class}`),role:"alert"},[e("strong",null,i(o(l).message),1)],2)):v("",!0),e("div",Ue,[e("button",{onClick:F(T,["prevent"]),id:"submitBtn",class:"btn btn-lg btn-custom btn-download hover-up"},"Make Payment",8,Xe)])],512),[[w,o(t).payment_type=="mpesa"]]),m(e("div",Je,null,512),[[w,o(t).payment_type=="paypal"]])])])):v("",!0),Le])])])])])])])]))}},$e=J(Ge,[["__scopeId","data-v-d759acea"]]);export{$e as default};
