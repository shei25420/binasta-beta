import{u as f,r as v,o as D,z as B,a as d,c as w,w as E,b as e,t as r,k as g,g as m,p as S,F as I,e as a,f as T,v as C,h as u,n as q,i as F}from"./app.193fc533.js";import{_ as N,a as A}from"./GenericLayout.0d75cf39.js";import{_ as j}from"./ModalComponent.f75aa5dd.js";import"./app.min.69abaa6c.js";import"./index.fcae608c.js";import"./_plugin-vue_export-helper.cdc0426e.js";const M={class:"card"},X={class:"card-body"},V={class:"invoice"},U={class:"d-md-flex justify-content-between align-items-center mb-4"},J=e("div",{class:"d-md-flex justify-content-between align-items-center"},[e("h4",null,"Invoice"),e("div",null,[e("img",{width:"120",src:A,alt:"logo"})])],-1),K=e("hr",{class:"my-4"},null,-1),$={class:"row"},G={class:"col-md-6"},H=e("p",{class:"text-start"},[e("strong",null,"Bill to")],-1),W={class:"mb-2"},z=e("br",null,null,-1),L={class:"table-responsive",tabindex:"1",style:{overflow:"hidden",outline:"none"}},Y={class:"table mb-4 mt-4"},Q=e("thead",{class:"thead-light"},[e("tr",null,[e("th",null,"Package"),e("th",{class:"text-end"},"Quantity"),e("th",{class:"text-end"},"Price"),e("th",{class:"text-end"},"Total")])],-1),Z={class:"text-start"},ee={class:"row"},te={key:0,class:"col-md-6"},se={class:"accordion accordion-with-radio",id:"accordionExample"},oe={class:"accordion-item"},ne={class:"accordion-header",id:"headingOne"},ae=e("div",{class:"form-check"},[e("input",{class:"form-check-input",type:"radio",name:"paymentFlexRadioDefault",id:"paypalFlexRadioDefault"}),e("label",{class:"form-check-label mb-0",for:"paypalFlexRadioDefault"}," Pay with Paypal ")],-1),re=[ae],le=e("div",{class:"accordion-body"},[e("div",{class:"col-md-12"},[e("img",{width:"50",class:"me-3",src:"#",alt:"..."}),e("div",{id:"paypalContainer",class:"col-sm-12"}),g(" You will be redirected to PayPal website to complete your purchase securely. ")])],-1),ie=[le],ce={class:"accordion-item"},de=e("h2",{class:"accordion-header",id:"headingThree"},[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseThree","aria-expanded":"false","aria-controls":"collapseThree"},[e("div",{class:"form-check"},[e("input",{class:"form-check-input",type:"radio",name:"paymentFlexRadioDefault",id:"cashOnDeliveryFlexRadioDefault"}),e("label",{class:"form-check-label mb-0",for:"cashOnDeliveryFlexRadioDefault"}," Pay with Mpesa ")])])],-1),pe={id:"collapseThree",class:"accordion-collapse collapse","aria-labelledby":"headingThree","data-bs-parent":"#accordionExample"},me={class:"accordion-body"},ue={class:"d-flex align-items-center"},he={class:"input-group mb-3"},_e=e("div",{class:"input-group-prepend"},[e("span",{style:{padding:"11px"},class:"input-group-text",id:"basic-addon1"},[e("strong",null,"+254")])],-1),ye={key:0,class:"invalid-feedback"},be={class:"form-group"},fe=["onClick"],ve={class:"col-md-6"},ge={class:"text-end"},xe=e("p",null,"Shipping: Free",-1),ke={class:"fw-bold"},we=["onSubmit"],Ee={class:"row"},Te={class:"col"},Ce={class:"form-group"},Fe=e("label",{for:"category name"},"Enter Mpesa Reference Number",-1),Oe={key:0,class:"invalid-feedback"},Pe=e("div",{class:"form-group mt-4"},[e("button",{type:"button",class:"btn btn-danger",style:{"margin-right":"10px"},"data-bs-dismiss":"modal"},"Close"),e("button",{id:"submitBtn",type:"submit",class:"btn btn-primary"},"Confirm")],-1),Ne={__name:"Invoice",props:{order:Object},setup(i){const y=i,s=f({phone_number:"",payment_type:"mpesa",order_ref:y.order.ref}),c=f({ref:""});let p=v(null);const O=f({order_ref:y.order.ref});let h=v(0),x=v(!1),k=null;const b=n=>{let t=0,o=0,l=n.discounts.length?(100-n.discounts[0].percentage)/100:0;return n.product_options.forEach(_=>{o+=parseFloat(_.price)*parseInt(_.min),t+=parseFloat(_.price)*parseInt(_.min)}),t=l?l*t:t,[t,o]},P=()=>{if(console.log(s.payment_type),s.clearErrors(),p.value=null,!s.phone_number||s.phone_number.trim()==""?s.setError("phone_number","Phone number is required"):s.phone_number.length>9&&s.setError("phone_number","Phone number is invalid. (Hint) Don't start with 0"),(!s.payment_type||s.payment_type.trim()=="")&&s.setError("payment_type","payment type is required"),(!s.order_ref||s.order_ref.trim()=="")&&s.setError("order_ref","Order ref is requireed"),s.errors&&Object.keys(s.errors).length)return;const n=document.getElementById("submitBtn");n.innerText="Making payment....",n.setAttribute("disabled",!0),fetch("/make_payment",{method:"POST",headers:{"Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(t=>t.startsWith("XSRF-TOKEN="))[0].split("=")[1])},body:JSON.stringify({phone_number:s.phone_number,payment_type:s.payment_type,order_ref:s.order_ref})}).then(t=>t.json()).then(t=>{t.status==1?k=setTimeout(function(){x.value=!0},5e3):console.log(t)}).catch(t=>console.log(t))},R=()=>{if(c.clearErrors(),!c.ref||c.ref.trim()===""){c.setError("ref","Reference number is required");return}const n=document.getElementById("submitBtn");n.innerText="Confirming...",n.setAttribute("disabled",!0),c.post("/query_payment",{onSuccess:t=>{console.log(t)},onFinish:()=>{n.innerText="Confirming...",n.removeAttribute("disabled")}})};return D(()=>{y.order.distributor_packages.forEach(t=>{h.value=b(t)[0],h.value*=t.quantity});let n=document.createElement("script");n.setAttribute("src","https://www.paypal.com/sdk/js?client-id=AaYT0UqlwWovXoGEp6qqBalZR32nG5gDXRVU546jy4_Gv_JrpRAF6fB8xp3gJ7cOTNmHJ-NVhAO4DxIC"),document.head.appendChild(n),n.addEventListener("load",()=>{paypal.Buttons({createOrder:async(t,o)=>fetch("/make_payment",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-XSRF-TOKEN":decodeURIComponent(document.cookie.split(";").filter(l=>l.startsWith("XSRF-TOKEN"))[0].split("=")[1])},body:JSON.stringify({payment_type:s.payment_type,order_ref:s.order_ref})}).then(l=>l.json()).then(l=>l.orderId).catch(l=>console.log("make payment paypal err",l)),onApprove:(t,o)=>{O.transform(l=>({...l,ref:t.orderID})).post("/capture/paypal",{onError:l=>{console.log("paypal capture err",l)}})}}).render("#paypalContainer")}),window.Echo.private(`distributor_payments.${B().props.value.auth.user.id}`).listen("MpesaPaymentCaptured",t=>{if(console.log(t),p.value={message:t.message},parseInt(t.status)===0)p.value.class="primary",clearTimeout(k),window.location.href="https://dashboard.binasta.co.ke/orders";else{p.value.class="danger";const o=document.getElementById("submitBtn");o.removeAttribute("disabled"),o.innerText="Make payment"}})}),(n,t)=>(d(),w(N,null,{default:E(()=>[e("div",M,[e("div",X,[e("div",V,[e("div",U,[e("div",null,"Invoice No : #"+r(i.order.ref),1),e("div",null,"Date: "+r(new Date(i.order.created_at).toDateString()),1)]),J,K,e("div",$,[e("div",G,[H,e("p",W,r(i.order.distributor.first_name)+" "+r(i.order.distributor.last_name),1),e("p",null,[g(r(i.order.location)+", ",1),z,g(r(i.order.phone_number),1)])])]),e("div",L,[e("table",Y,[Q,e("tbody",null,[(d(!0),m(I,null,S(i.order.distributor_packages,o=>(d(),m("tr",{class:"text-end",key:o.id},[e("td",Z,r(o.name),1),e("td",null,r(o.quantity),1),e("td",null,"ksh."+r(b(o)[0]),1),e("td",null,"ksh."+r(b(o)[1]*o.quantity),1)]))),128))])])]),e("div",ee,[i.order.status==0?(d(),m("div",te,[e("div",se,[e("div",oe,[e("h2",ne,[e("button",{class:"accordion-button collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#collapseOne","aria-expanded":"false","aria-controls":"collapseOne",onClick:t[0]||(t[0]=()=>a(s).payment_type="paypal")},re)]),e("div",{id:"collapseOne",class:"accordion-collapse collapse","aria-labelledby":"headingOne","data-bs-parent":"#accordionExample",onClick:t[1]||(t[1]=()=>a(s).payment_type="paypal")},ie)]),e("div",ce,[de,e("div",pe,[e("div",me,[e("div",ue,[e("div",he,[_e,T(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>a(s).phone_number=o),placeholder:"Enter phone number",class:"form-control"},null,512),[[C,a(s).phone_number]])]),a(s).errors.phone_number?(d(),m("div",ye,r(a(s).errors.phone_number),1)):u("",!0),a(p)?(d(),m("div",{key:1,class:q(`alert alert-${a(p).class}`),role:"alert"},[e("strong",null,r(a(p).message),1)],2)):u("",!0)]),e("div",be,[e("button",{onClick:F(P,["prevent"]),id:"submitBtn",class:"btn btn-primary"},"Make Payment",8,fe)])])])])])])):u("",!0),e("div",ve,[e("div",ge,[e("p",null,"Sub Total: ksh."+r(a(h)),1),xe,e("h4",ke,"Total: ksh."+r(a(h)),1)])])])])])]),a(x)?(d(),w(j,{key:0,title:"Confirm Payment"},{default:E(()=>[e("form",{onSubmit:F(R,["prevent"])},[e("div",Ee,[e("div",Te,[e("div",Ce,[Fe,T(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>a(c).ref=o),class:"form-control"},null,512),[[C,a(c).ref]]),a(c).errors.ref?(d(),m("div",Oe,r(a(c).errors.ref),1)):u("",!0)])])]),Pe],40,we)]),_:1})):u("",!0)]),_:1}))}};export{Ne as default};
